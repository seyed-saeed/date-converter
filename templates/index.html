<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تبدیل تاریخ شمسی، میلادی، قمری + اوقات شرعی آنلاین</title>
  <link rel="stylesheet" href="static/style.css">
</head>
<body>
  <div id="spinner" class="spinner-wrapper">
    <div class="spinner"></div>
    <p class="loading-text">در حال انتقال سایت، لطفاً صبور باشید…</p>
    <div class="tip-box">
      <p id="tip-text" class="tip-show">⏳ آماده‌سازی سرور در حال انجام است…</p>
    </div>
  </div>

  <div class="container">
    <h1>تبدیل تاریخ و اوقات شرعی</h1>

    <form method="POST">
      <input type="hidden" name="action" value="convert">
      <div class="row">
        <label>نوع تبدیل:</label>
        <div class="radio-group">
          <label><input type="radio" name="mode" value="shamsi" checked onchange="updateFields()"> شمسی</label>
          <label><input type="radio" name="mode" value="miladi" onchange="updateFields()"> میلادی</label>
          <label><input type="radio" name="mode" value="hijri" onchange="updateFields()"> قمری</label>
        </div>
      </div>

      <div class="row-horizontal" id="shamsi-fields">
        <select name="year">
          {% for y in years_shamsi %}
            <option value="{{ y }}">{{ y }}</option>
          {% endfor %}
        </select>
        <select name="month">
          {% for num, name in shamsi_months.items() %}
            <option value="{{ num }}">{{ name }}</option>
          {% endfor %}
        </select>
        <select name="day">
          {% for d in days %}
            <option value="{{ d }}">{{ d }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="row-horizontal hidden" id="miladi-fields">
        <select name="year_m">
          {% for y in years_miladi %}
            <option value="{{ y }}">{{ y }}</option>
          {% endfor %}
        </select>
        <select name="month_m">
          {% for num, name in miladi_months.items() %}
            <option value="{{ num }}">{{ name }}</option>
          {% endfor %}
        </select>
        <select name="day_m">
          {% for d in days %}
            <option value="{{ d }}">{{ d }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="row-horizontal hidden" id="hijri-fields">
        <select name="year_h">
          {% for y in years_hijri %}
            <option value="{{ y }}">{{ y }}</option>
          {% endfor %}
        </select>
        <select name="month_h">
          {% for num, name in hijri_months.items() %}
            <option value="{{ num }}">{{ name }}</option>
          {% endfor %}
        </select>
        <select name="day_h">
          {% for d in days %}
            <option value="{{ d }}">{{ d }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="buttons">
        <button type="submit">🔄 تبدیل</button>
      </div>
    </form>

    {% if result and result.action == "convert" %}
      <div class="result">
        {% if result.error %}
          <p class="error">{{ result.error }}</p>
        {% else %}
          {% if result.shamsi %}<p>📅 تاریخ شمسی: <strong>{{ result.shamsi }}</strong></p>{% endif %}
          {% if result.miladi %}<p>📆 تاریخ میلادی: <strong>{{ result.miladi }}</strong></p>{% endif %}
          {% if result.hijri %}<p>🌙 تاریخ قمری: <strong>{{ result.hijri }}</strong></p>{% endif %}
          {% if result.weekday %}<p>🗓 روز هفته: <strong>{{ result.weekday }}</strong></p>{% endif %}
          {% if result.age_days %}<p>📆 تعداد روزهای گذشته: <strong>{{ result.age_days }}</strong> روز</p>{% endif %}
          {% if result.age %}<p>🎂 سن دقیق: <strong>{{ result.age }}</strong></p>{% endif %}
          {% if result.month_symbol %}<p>🪐 نماد ماه شمسی: <strong>{{ result.month_symbol }}</strong></p>{% endif %}
          {% if result.hijri_symbol %}<p>🌙 نماد ماه قمری: <strong>{{ result.hijri_symbol }}</strong></p>{% endif %}
          {% if result.miladi_zodiac %}<p>♉ Zodiac Sign: <strong>{{ result.miladi_zodiac }}</strong></p>{% endif %}
        {% endif %}
      </div>
    {% endif %}

    <form method="POST">
      <input type="hidden" name="action" value="today">
      <div class="buttons">
        <button type="submit">📅 امروز</button>
      </div>
    </form>

    {% if result and result.action == "today" %}
      <div class="result">
        {% if result.error %}
          <p class="error">{{ result.error }}</p>
        {% else %}
          <p>📌 {{ result.today_text }}</p>
          <p>🌙 تاریخ قمری: <strong>{{ result.hijri_today }}</strong></p>
        {% endif %}
      </div>
    {% endif %}

    <div class="buttons">
      <button type="button" onclick="showPrayerForm()">🕌 اوقات شرعی</button>
    </div>

    <div id="prayer-wrapper" class="hidden">
      <form method="POST" id="prayer-form">
        <input type="hidden" name="action" value="prayer">
        <div class="row">
          <label for="city">نام شهر:</label>
          <input type="text" name="city" id="city" placeholder="مثلاً Mashhad">
        </div>
        <div class="buttons">
          <button type="submit">✅ تأیید</button>
        </div>
      </form>
    </div>

    {% if result and result.action == "prayer" %}
      <div class="result">
        {% if result.error %}
          <p class="error">{{ result.error }}</p>
        {% else %}
          <h3>🕌 اوقات شرعی امروز در {{ result.city_name }}</h3>
          <p>اذان صبح: {{ result.prayer_times.Fajr }}</p>
          <p>طلوع آفتاب: {{ result.prayer_times.Sunrise }}</p>
          <p>اذان ظهر: {{ result.prayer_times.Dhuhr }}</p>
          <p>اذان عصر: {{ result.prayer_times.Asr }}</p>
          <p>اذان مغرب: {{ result.prayer_times.Maghrib }}</p>
          <p>اذان عشاء: {{ result.prayer_times.Isha }}</p>
        {% endif %}
      </div>
    {% endif %}
  </div>

<script>
  function showPrayerForm() {
    document.getElementById("prayer-wrapper").classList.remove("hidden");
  }

  function updateFields() {
    const mode = document.querySelector('input[name="mode"]:checked').value;
    document.getElementById("shamsi-fields").classList.add("hidden");
    document.getElementById("miladi-fields").classList.add("hidden");
    document.getElementById("hijri-fields").classList.add("hidden");

    if (mode === "shamsi") {
      document.getElementById("shamsi-fields").classList.remove("hidden");
    } else if (mode === "miladi") {
      document.getElementById("miladi-fields").classList.remove("hidden");
    } else if (mode === "hijri") {
      document.getElementById("hijri-fields").classList.remove("hidden");
    }
  }

  const tips = [
    "📅 تبدیل تاریخ شمسی، میلادی، قمری فقط با یک کلیک",
    "🕌 دریافت اوقات شرعی دقیق برای هر شهر ایران",
    "🎂 محاسبه سن دقیق بر اساس تاریخ تولد",
    "🪐 نمایش نماد ماه تولد به سبک ایرانی، عربی و غربی",
    "📆 نمایش روز هفته به سه زبان: فارسی، انگلیسی، عربی",
    "🧠 معمای روز: اگر امروز جمعه باشد، ۵ روز بعد چه روزی‌ست؟",
    "📜 تبدیل تاریخ به حروف فارسی کامل",
    "🕋 نمایش تاریخ هجری قمری با نماد عربی",
    "🧭 نمایش موقعیت جغرافیایی شهر انتخاب‌شده",
    "🧮 محاسبه فاصله بین دو تاریخ",
    "🧘 نمایش نماد ماه تولد بر اساس طالع‌بینی ایرانی",
    "🧩 معما: اگر ۳ روز قبل دیروز، شنبه بوده باشد، امروز چه روزی‌ست؟",
    "📈 نمایش روند تغییر تاریخ در تقویم‌های مختلف",
    "🕰️ تبدیل ساعت جهانی به ساعت ایران",
    "🧠 معما: اگر فردا دیروزِ پس‌فردا باشد، امروز چه روزی‌ست؟",
    "📖 نمایش مناسبت‌های روز در تقویم رسمی",
    "🧠 معما: اگر امروز دوشنبه باشد، ۱۰ روز قبل چه روزی بوده؟",
    "🧠 معما: اگر دیروز فردا باشد، امروز چه روزی‌ست؟",
    "🧠 معما: اگر امروز روزی قبل از جمعه باشد، چه روزی‌ست؟",
    "🧠 معما: اگر ۲ روز بعد از فردا، شنبه باشد، امروز چه روزی‌ست؟",
    "🧠 معما: اگر دیروز، روزی قبل از پنج‌شنبه باشد، امروز چه روزی‌ست؟",
    "🧠 معما: اگر امروز وسط هفته باشد، چه روزی‌ست؟",
    "🧠 معما: اگر فردا روزی قبل از شنبه باشد، امروز چه روزی‌ست؟",
    "🧠 معما: اگر امروز روزی بعد از سه‌شنبه باشد، چه روزی‌ست؟",
    "🧠 معما: اگر دیروز روزی قبل از یکشنبه باشد، امروز چه روزی‌ست؟",
    "🧠 معما: اگر امروز روزی قبل از فردا باشد، چه روزی‌ست؟",
    "🧠 معما: اگر امروز روزی بعد از دیروز باشد، چه روزی‌ست؟",
    "🧠 معما: اگر امروز روزی بین شنبه و دوشنبه باشد، چه روزی‌ست؟",
    "🧠 معما: اگر امروز روزی قبل از روزی قبل از جمعه باشد، چه روزی‌ست؟"
  ];

  let shuffledTips = [];
  let currentIndex = 0;
  const tipText = document.getElementById("tip-text");

  function shuffleTips() {
    shuffledTips = [...tips];
    for (let i = shuffledTips.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffledTips[i], shuffledTips[j]] = [shuffledTips[j], shuffledTips[i]];
    }
    currentIndex = 0;
  }

  function showNextTip() {
    tipText.classList.remove("tip-show");
    tipText.classList.add("tip-fade");

    setTimeout(() => {
      if (currentIndex >= shuffledTips.length) {
        shuffleTips();
      }
      tipText.textContent = shuffledTips[currentIndex];
      currentIndex++;
      tipText.classList.remove("tip-fade");
      tipText.classList.add("tip-show");
    }, 1000);
  }

  shuffleTips();
  setInterval(showNextTip, 10000);

  window.addEventListener("load", function () {
    const spinner = document.getElementById("spinner");

    fetch("/status")
      .then(res => res.json())
      .then(data => {
        if (data.ready) {
          spinner.style.display = "none";
          updateFields();
        } else {
          setTimeout(() => {
            spinner.style.display = "none";
            updateFields();
          }, 60000);
        }
      })
      .catch(() => {
        setTimeout(() => {
          spinner.style.display = "none";
          updateFields();
        }, 60000);
      });
  });
</script>
</body>
</html>
